(function(b){function a(a,l,c,f){f={data:f||(l?l.data:{}),_wrap:l?l._wrap:null,tmpl:null,parent:l||null,nodes:[],calls:q,nest:r,wrap:A,html:B,update:C};a&&b.extend(f,a,{nodes:[],parent:l});c&&(f.tmpl=c,f._ctnt=f._ctnt||f.tmpl(b,f),f.key=++t,(w.length?u:n)[t]=f);return f}function c(a,l,d){var f;d=d?b.map(d,function(b){return"string"===typeof b?a.key?b.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,'$1 _tmplitem="'+a.key+'" $2'):b:c(b,a,b._ctnt)}):a;if(l)return d;d=d.join("");d.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(a,l,m,c){f=b(m).get();g(f);l&&(f=e(l).concat(f));c&&(f=f.concat(e(c)))});return f?f:e(d)}function e(a){var l=document.createElement("div");l.innerHTML=a;return b.makeArray(l.childNodes)}function d(a){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+b.trim(a).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(a,c,m,d,e,g,h){a=b.tmpl.tag[m];if(!a)throw"Template command not found: "+m;m=a._default||[];g&&!/\w$/.test(e)&&(e+=g,g="");e?(e=k(e),h=h?","+k(h)+")":g?")":"",h=g?-1<e.indexOf(".")?e+g:"("+e+").call($item"+h:e,g=g?h:"(typeof("+e+")==='function'?("+e+").call($item):("+e+"))"):g=h=m.$1||"null";d=k(d);return"');"+a[c?"close":"open"].split("$notnull_1").join(e?"typeof("+e+")!=='undefined' && ("+e+")!=null":"true").split("$1a").join(g).split("$1").join(h).split("$2").join(d?d.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,
function(a,b,m,c){return(c=c?","+c+")":m?")":"")?"("+b+").call($item"+c:a}):m.$2||"")+"_.push('"})+"');}return _;")}function h(a,l){a._wrap=c(a,!0,b.isArray(l)?l:[x.test(l)?l:b(l).html()]).join("")}function k(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function g(c){function l(c){function d(b){b+=e;f=h[b]=h[b]||a(f,n[f.parent.key+e]||f.parent,null,!0)}var l,m=c,f,g;if(g=c.getAttribute("_tmplitem")){for(;m.parentNode&&1===(m=m.parentNode).nodeType&&!(l=m.getAttribute("_tmplitem")););
l!==g&&(m=m.parentNode?11===m.nodeType?0:m.getAttribute("_tmplitem")||0:0,(f=n[g])||(f=u[g],f=a(f,n[m]||u[m],null,!0),f.key=++t,n[t]=f),p&&d(g));c.removeAttribute("_tmplitem")}else p&&(f=b.data(c,"tmplItem"))&&(d(f.key),n[f.key]=f,m=(m=b.data(c.parentNode,"tmplItem"))?m.key:0);if(f){for(l=f;l&&l.key!=m;)l.nodes.push(c),l=l.parent;delete f._ctnt;delete f._wrap;b.data(c,"tmplItem",f)}}var e="_"+p,d,g,h={},k,q,r;k=0;for(q=c.length;k<q;k++)if(1===(d=c[k]).nodeType){g=d.getElementsByTagName("*");for(r=
g.length-1;0<=r;r--)l(g[r]);l(d)}}function q(a,b,c,f){if(!a)return w.pop();w.push({_:a,tmpl:b,item:this,data:c,options:f})}function r(a,c,d){return b.tmpl(b.template(a),c,d,this)}function A(a,c){var d=a.options||{};d.wrapped=c;return b.tmpl(b.template(a.tmpl),a.data,d,a.item)}function B(a,c){var d=this._wrap;return b.map(b(b.isArray(d)?d.join(""):d).filter(a||"*"),function(a){if(c)a=a.innerText||a.textContent;else{var b;(b=a.outerHTML)||(b=document.createElement("div"),b.appendChild(a.cloneNode(!0)),
b=b.innerHTML);a=b}return a})}function C(){var a=this.nodes;b.tmpl(null,null,null,this).insertBefore(a[0]);b(a).remove()}var y=b.fn.domManip,x=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,n={},u={},v,z={key:0,data:{}},t=0,p=0,w=[];b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,c){b.fn[a]=function(d){var e=[];d=b(d);var g,h,k;g=1===this.length&&this[0].parentNode;v=n||{};if(g&&11===g.nodeType&&1===g.childNodes.length&&1===d.length)d[c](this[0]),
e=this;else{h=0;for(k=d.length;h<k;h++)p=h,g=(0<h?this.clone(!0):this).get(),b.fn[c].apply(b(d[h]),g),e=e.concat(g);p=0;e=this.pushStack(e,a,d.selector)}d=v;v=null;b.tmpl.complete(d);return e}});b.fn.extend({tmpl:function(a,c,d){return b.tmpl(this[0],a,c,d)},tmplItem:function(){return b.tmplItem(this[0])},template:function(a){return b.template(a,this[0])},domManip:function(a,c,d){if(a[0]&&a[0].nodeType){for(var e=b.makeArray(arguments),g=a.length,h=0,k;h<g&&!(k=b.data(a[h++],"tmplItem")););1<g&&(e[0]=
[b.makeArray(a)]);k&&p&&(e[2]=function(a){b.tmpl.afterManip(this,a,d)});y.apply(this,e)}else y.apply(this,arguments);p=0;!v&&b.tmpl.complete(n);return this}});b.extend({tmpl:function(d,e,g,f){var k=!f;if(k)f=z,d=b.template[d]||b.template(null,d),u={};else if(!d)return d=f.tmpl,n[f.key]=f,f.nodes=[],f.wrapped&&h(f,f.wrapped),b(c(f,null,f.tmpl(b,f)));if(!d)return[];"function"===typeof e&&(e=e.call(f||{}));g&&g.wrapped&&h(g,g.wrapped);e=b.isArray(e)?b.map(e,function(b){return b?a(g,f,d,b):null}):[a(g,
f,d,e)];return k?b(c(f,null,e)):e},tmplItem:function(a){var d;for(a instanceof b&&(a=a[0]);a&&1===a.nodeType&&!(d=b.data(a,"tmplItem"))&&(a=a.parentNode););return d||z},template:function(a,c){return c?("string"===typeof c?c=d(c):c instanceof b&&(c=c[0]||{}),c.nodeType&&(c=b.data(c,"tmpl")||b.data(c,"tmpl",d(c.innerHTML))),"string"===typeof a?b.template[a]=c:c):a?"string"!==typeof a?b.template(null,a):b.template[a]||b.template(null,x.test(a)?a:b(a)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});
b.extend(b.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},
open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){n={}},afterManip:function(a,c,d){var e=11===c.nodeType?b.makeArray(c.childNodes):1===c.nodeType?[c]:[];d.call(a,c);g(e);p++}})})(jQuery);var translate={};String.prototype.translate=function(){return translate[this]?translate[this]:this};
(function(){var b=this.console,a=this.console={};a.production=!1;b&&!b.time&&(b.time=function(b,c){if(b){var e=(new Date).getTime();a.timeCounters||(a.timeCounters={});var g="KEY"+b.toString();if(c||!a.timeCounters[g])a.timeCounters[g]=e}},b.timeEnd=function(b){var c=(new Date).getTime();if(!a.timeCounters)return null;var e="KEY"+b.toString(),g=a.timeCounters[e];if(g){var q=c-g;a.info(b+": "+q+"ms");delete a.timeCounters[e]}return q});for(var c="assert count debug dir dirxml error group groupCollapsed groupEnd info log markTimeline profile profileEnd table time timeEnd trace warn".split(" "),
e=c.length;e--;)(function(c){a[c]=function(){if(b&&c in b&&!a.production)try{b[c].apply(b,arguments)}catch(e){alert(arguments)}}})(c[e])})();
(function(b){b.installer={options:{cache_url:"?module=settings&action=clearCache",redirect_url:null,redirect_timeout:3E3,updateStateInterval:2E3,updateStateErrorInterval:6E3,queue:[],install:!1,logMode:"raw",timestamp:null,end:null},timeout:{state:null},counter:0,offset:0,complete:null,thread_id:null,init:function(a,c){this.trace("init");this.thread_id=c||null;this.options=b.extend({},this.options,a||{});this.options.timestamp&&(this.offset=(new Date).getTime()/1E3-parseInt(this.options.timestamp),
10<Math.abs(this.offset)&&console.error("Invalid timestamp at response, check server time",this.offset));var e=this;this.helper.compileTemplates();this.options.queue.length?this.execute("update",this.options.queue):this.execute("state",null);b("body").addClass("i-fixed-body");this.onResize();b(window).resize(function(){e.onResize()});this.options.auto_submit&&console.log("It go to update!",b(':input[name^="app_id["]').length)},helper:{plural:function(a){return 1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&
(10>a%100||20<=a%100)?1:2},compileTemplates:function(){var a=/<\\\/(\w+)/g;b("script[type$='x-jquery-tmpl']").each(function(){try{var c=b(this).attr("id").replace(/-template-js$/,"");b.installer.trace("Compile template",c);b.template(c,b(this).html().replace(a,"</$1"))}catch(e){console.error(e)}})},subject:function(a){var b,e="generic";a.match(/^wa-apps/)?e=(b=a.match(/^wa-apps\/\w+\/(\w+)/))?"app_"+b[1]:"apps":a.match(/^wa-plugins/)?e=(b=a.match(/^wa-plugins\/\w+\/(\w+)/))?"systemplugins_"+b[1]:
"systemplugins":a.match(/^wa-widgets/)&&(e="system_widgets");return e},hideCounter:function(a){setTimeout(function(){b("#wa-app-installer span.indicator").remove();b("#wa-app li span.indicator").remove()},a||500)}},onResize:function(){setInterval(function(){b(".content .i-app-update-screen").css("max-height",parseInt(b("#wa").css("height"))-110+"px")},500)},execute:function(a,b){a=a||"default";this.trace("execute action "+a,b);if(this[a+"Action"]){this.currentAction=a;this.currentActionAttr=b;try{return this[a+
"Action"](b)}catch(e){console.error("Exception while execute "+a+"Action",e)}}else console.error("Invalid action name",a+"Action");return null},defaultAction:function(){},stateAction:function(){var a=this;try{this.sendRequest("?module=update&action=state",{mode:this.options.logMode},function(b){a.updateStateHandler(b)},function(b){a.updateStateErrorHandler(b)})}catch(b){console.error("Exception while execute stateAction",b),this.execute("state",null)}},updateAction:function(a){var b=this;this.sendRequest("?module=update&action=execute",
{thread_id:this.thread_id,app_id:a,mode:this.options.logMode,install:this.options.install?"1":"0"},function(a){try{b.updateExecuteHandler(a)}catch(d){console.error("Exception while execute updateExecuteHandler",d)}},function(a){try{b.updateExecuteErrorHandler(a)}catch(d){console.error("Exception while execute updateExecuteErrorHandler",d)}},function(){b.timeout.state=setTimeout(function(){b.execute("state",null)},Math.max(2E3,4*b.options.updateStateInterval))})},updateExecuteHandler:function(a){this.trace("updateExecuteHandler",
a);this.timeout.state&&clearTimeout(this.timeout.state);var c={success:0,success_plural:0,fail:0,fail_plural:0},e={},d=!1,h="generic";if(a){this.complete=!0;if(a.sources)for(var k in a.sources)a.sources.hasOwnProperty(k)&&(h=this.helper.subject(a.sources[k].target),"generic"!==h&&(e[h]||(e[h]={success:0,fail:0,plural:null}),a.sources[k].skipped?(++c.fail,d=d||"no",++e[h].fail):(++c.success,d=d||"yes",++e[h].success)));c.success_plural=this.helper.plural(c.success);c.fail_plural=this.helper.plural(c.fail);
d=d||"no";this.helper.hideCounter(100);var g=this;this.drawStateInfo(a.state,d);setTimeout(function(){b.tmpl("application-update-result",{current_state:a.current_state,result:c,sources:a.sources}).appendTo("#update-raw");setTimeout(function(){var a=b("div.i-app-update-screen :last").offset().top;b("div.i-app-update-screen").scrollTop(a);g.redirectOnComplete();g.animateOnInstall()},500)},500)}},updateExecuteErrorHandler:function(a){this.trace("updateExecuteErrorHandler",a)},updateStateHandler:function(a){this.trace("stateHandler",
a);(this.timeout.state||this.complete)&&clearTimeout(this.timeout.state);var c=this;try{if(this.complete)this.redirectOnComplete();else{var e=!1,d=new Date,h=a.current_state?Math.abs(this.offset-(d.getTime()/1E3-parseInt(a.current_state.timestamp))):null,k=a.current_state&&15>h;k&&("error"===a.current_state.stage_status?e=!0:"complete"===a.current_state.stage_status&&"update"===a.current_state.stage_name&&(e=!0));e?(this.drawStateInfo(a.state,"error"===a.current_state.stage_status?"no":"yes"),b.tmpl("application-update-result",
{current_state:a.current_state,result:null}).appendTo("#update-raw")):k&&a.state&&"none"!==a.current_state.stage_status?(this.drawStateInfo(a.state),this.timeout.state=setTimeout(function(){c.complete||c.execute("state",null)},this.options.updateStateInterval)):this.timeout.state=setTimeout(function(){c.complete||c.execute("state",null)},this.options.updateStateErrorInterval)}}catch(g){this.timeout.state=setTimeout(function(){c.complete||c.execute("state",null)},this.options.updateStateErrorInterval),
console.error("updateStateHandler error: "+g.message,g)}},updateStateErrorHandler:function(a){this.trace("StateErrorHandler",a);this.timeout.state&&clearTimeout(this.timeout.state);var b=this;this.timeout.state=setTimeout(function(){b.complete||b.execute("state",null)},this.options.updateStateErrorInterval)},drawStateInfo:function(a,c){var e,d;c=c||"loading";switch(this.options.logMode){case "raw":if(a&&a.length){for(e in a)a.hasOwnProperty(e)&&!a[e].datetime&&(a[e].datetime=new Date(1E3*parseInt(a[e].stage_start_time)));
d=b("#template-placeholder").html();try{b("#template-placeholder").empty(),b.tmpl("application-update-raw",{stages:a,apps:this.options.queue,state_class:c}).appendTo("#template-placeholder")}catch(h){console.error("Error while parse template ",h),b("#template-placeholder").html(d)}}break;default:d=b("#template-placeholder").html();try{b("#template-placeholder").empty();for(var k in a)if(a.hasOwnProperty(k)){for(e in a[k])a[k].hasOwnProperty(e)&&!a[k][e].datetime&&(a[k][e].datetime=new Date(1E3*parseInt(a[k][e].stage_start_time)));
var g=new Date(1E3*parseInt(a[k][1].stage_start_time));b.tmpl("application-update-apps",{slug:k,timestamp:g,stages:a[k],state_class:c}).appendTo("#template-placeholder")}}catch(h){console.error("Error while parse template ",h),b("#template-placeholder").html(d)}}setTimeout(function(){var a=b("div.i-app-update-screen :last").offset().top;b("div.i-app-update-screen").scrollTop(a)},100)},redirectOnComplete:function(){this.clearCache();if(this.options.redirect_url){var a=this;setTimeout(function(){window.location=
a.options.redirect_url},this.options.redirect_timeout)}},animateOnInstall:function(){var a=b("#wa-applist ul");b("#update-result-apps li").each(function(){var c=b(this);c.parent().show();var e=c.offset(),d=null,h=a.find("> li[id^="+c.attr("id")+"]");h.length?d=h.offset():(d=a.find("#wa-moreapps").offset(),d.left||(d=a.find("> li[id^=wa-app-]:last").offset(),d.left+=75));var d={left:d.left,top:d.top},k={top:0,left:0,position:"relative",display:"inline-block"};c.css({top:e.top,left:e.left,position:"absolute",
display:"inline-block"});c.animate(d,700,function(){c.css(k);h.length?h.replaceWith(c):c.appendTo(a);b(window).resize()})})},trace:function(a,b){},sendRequest:function(a,c,e,d,h){var k=this;b.ajax({url:a+"&timestamp="+(new Date).getTime(),data:c,type:"GET",dataType:"json",success:function(a,c){try{try{"object"!==typeof a&&(a=b.parseJSON(a))}catch(h){throw console.error("Invalid server JSON response",h),"function"===typeof d&&d(),h;}if(a)switch(a.status){case "fail":k.displayMessage(a.errors.error||
a.errors,"error");"function"===typeof d&&d(a);break;case "ok":"function"===typeof e&&e(a.data);break;default:console.error("unknown status response",a.status),"function"===typeof d&&d(a)}else console.error("empty response",c),"function"===typeof d&&d(),k.displayMessage("Empty server response","warning")}catch(h){console.error("Error handling server response ",h),"function"===typeof d&&d(a),k.displayMessage("Invalid server response<br>"+h.description,"error")}},error:function(a,b,c){console.error("AJAX request error",
[b,c]);"function"===typeof d&&d();k.displayMessage("AJAX request error","warning")},beforeSend:h})},displayMessage:function(a,b){},clearCache:function(){this.options.cache_url&&b.ajax({url:this.options.cache_url,type:"GET",dataType:"json",success:this.responseHandler})},responseHandler:function(a){var c=b.installer;try{"ok"!==a.status&&setTimeout(function(){c.clearCache()},3E3)}catch(e){}}}})(jQuery);
//# sourceMappingURL=installer.min.js.map